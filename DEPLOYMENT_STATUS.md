# üè≠ Warehouse Automation - –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: 26 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã**: ‚ö†Ô∏è **80% –≥–æ—Ç–æ–≤–æ** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ KeyCRM API

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –û–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ Python virtual environment –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã 
- ‚úÖ `.env` —Ñ–∞–π–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Google Sheets API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Telegram Bot API –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### 2. Webhook —Å–µ—Ä–≤–µ—Ä
- ‚úÖ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ http://localhost:8000
- ‚úÖ Endpoint `/webhook/keycrm` –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ Health check `/health` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `/docs`
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ https://blanks.timosh-design.com/webhook/keycrm

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ webhook –æ—Ç KeyCRM
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è `order.change_order_status` 
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ (status_id: 1,2,3)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω API URL –¥–ª—è KeyCRM (api.keycrm.app –≤–º–µ—Å—Ç–æ openapi)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–µ–Ω–∞ —Å–æ–±—ã—Ç–∏–π webhook (order.change_order_status)
- ‚úÖ –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ HMAC –ø–æ–¥–ø–∏—Å–∏ (KeyCRM –µ—ë –Ω–µ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ structured logging
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

---

## ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### KeyCRM API Authentication
**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ API endpoints KeyCRM –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç HTML –≤–º–µ—Å—Ç–æ JSON

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**:
- `Authorization: Bearer <token>`
- `X-Api-Key: <token>`
- `Api-Token: <token>` 
- Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `?token=<token>`

**–í—Å–µ –º–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç**: HTTP 200 + HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É KeyCRM

---

## üîß –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å KeyCRM API —Ç–æ–∫–µ–Ω
1. –ó–∞–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å KeyCRM ‚Üí Settings ‚Üí Integrations ‚Üí API
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å API —Ç–æ–∫–µ–Ω–∞ 
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
4. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–æ–∫–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ KeyCRM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è API –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
- –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–∞ –¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è API

### 3. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è API
```bash
# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –¥–æ—Å—Ç—É–ø
python debug_keycrm_api2.py

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
# –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –≤ KeyCRM ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É webhook
```

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
KeyCRM ‚Üí Webhook ‚Üí FastAPI ‚Üí Stock Service ‚Üí Google Sheets
                           ‚Üì
                    Telegram Bot (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
```

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞:
1. **KeyCRM**: –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ ‚Üí webhook `order.change_order_status`
2. **Webhook**: –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ ‚Üí –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å
3. **API**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ (‚ùå **–ù–ï –†–ê–ë–û–¢–ê–ï–¢**)
4. **Stock**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥–æ—Ç–æ–≤–æ–∫ 
5. **Sheets**: –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏
6. **Telegram**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞
```bash
cd "/mnt/g/Github Repositories/Warehouse_Automation"
source venv/bin/activate
uvicorn src.webhook.app:app --host 0.0.0.0 --port 8000 --reload
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
python system_status_test.py
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ KeyCRM API
```bash
python debug_keycrm_api2.py
```

---

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ KeyCRM

### Webhook URL –≤ KeyCRM:
```
https://blanks.timosh-design.com/webhook/keycrm
```

### –°–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏:
- ‚úÖ `order.change_order_status` (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞)

### –°—Ç–∞—Ç—É—Å—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- ‚úÖ Status ID: 1, 2, 3 (–Ω–æ–≤—ã–µ/–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã)
- ‚úÖ Status names: "new", "created", "pending", "active"

---

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å KeyCRM API** (–∫—Ä–∏—Ç–∏—á–Ω–æ)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å end-to-end —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –∑–∞–∫–∞–∑–æ–º**
5. **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

---

## üí° –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f logs/webhook.log`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: `curl http://localhost:8000/health`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: http://localhost:8000/docs

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è KeyCRM API!**