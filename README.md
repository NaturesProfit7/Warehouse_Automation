# Timosh Blanks - MVP ัะธััะตะผะฐ ะบะพะฝััะพะปั ะพััะฐัะบะพะฒ ะทะฐะณะพัะพะฒะพะบ

MVP ัะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฟะปะฐะฝะธัะพะฒะฐะฝะธั ะทะฐะบัะฟะพะบ ะผะตัะฐะปะปะธัะตัะบะธั ะทะฐะณะพัะพะฒะพะบ ะดะปั ะฐะดัะตัะฝะธะบะพะฒ.

## ะะพะทะผะพะถะฝะพััะธ

- โ **ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฐััะตั ะฟะพััะตะฑะฝะพััะธ** ะฒ ะทะฐะณะพัะพะฒะบะฐั ั ััะตัะพะผ ะฑัะฐะบะฐ ะธ ััะพะบะพะฒ ะฟะพััะฐะฒะบะธ
- โ **ะะถะตะดะฝะตะฒะฝัะต ัะฒะตะดะพะผะปะตะฝะธั** ะพ ะฝะตะพะฑัะพะดะธะผะพััะธ ะทะฐะบัะฟะบะธ ัะตัะตะท Telegram
- โ **ะัะพััะพะน ััะตั ะฟัะธัะพะดะพะฒ** ัะตัะตะท Telegram-ะฑะพั ั ะธะฝััะธัะธะฒะฝัะผ ะธะฝัะตััะตะนัะพะผ  
- โ **ะะพะปะฝะฐั ะฟัะพะทัะฐัะฝะพััั ะพััะฐัะบะพะฒ** ะฒ Google Sheets
- โ **Webhook ะธะฝัะตะณัะฐัะธั** ั KeyCRM ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฟะธัะฐะฝะธั
- โ **20 ะฒะธะดะพะฒ ะทะฐะณะพัะพะฒะพะบ** (ะบะพััั, ะฑัะฑะปะธะบ, ะบััะณะปัะต, ัะธะณััะฝัะต ัะพัะผั)

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   KeyCRM    โโโโโถโ   Webhook    โโโโโถโ  Google Sheets  โ
โ  (ะทะฐะบะฐะทั)   โ    โ (ัะฟะธัะฐะฝะธะต)   โ    โ  (ะดะฒะธะถะตะฝะธั)     โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                            โ                    โฒ
                            โผ                    โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ              โ
โ Telegram    โโโโโโ  Scheduler   โโโโโโโโโโโโโโโโ
โ (ัะฒะตะดะพะผะปะตะฝะธั)โ    โ (ัะฐััะตัั)    โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
       โฒ                    
       โ            โโโโโโโโโโโโโโโโ
       โโโโโโโโโโโโโโ Telegram Bot โ
                    โ (ะฟัะธัะพะดั)    โ
                    โโโโโโโโโโโโโโโโ
```

## ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะฟัะพะตะบัะฐ

```bash
git clone <repository_url>
cd Warehouse_Automation
```

### 2. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

```bash
cp .env.example .env
# ะััะตะดะฐะบัะธััะนัะต .env ัะฐะนะป ั ะฒะฐัะธะผะธ ะดะฐะฝะฝัะผะธ
```

### 3. ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
make install-dev

# ะะฐะฟััะบ dev ะพะบััะถะตะฝะธั
make dev

# ะัะพัะผะพัั ะปะพะณะพะฒ
make dev-logs
```

### 4. ะะฝะธัะธะฐะปะธะทะฐัะธั Google Sheets

```bash
# ะะพัะปะต ะฝะฐัััะพะนะบะธ GOOGLE_CREDENTIALS_JSON
python scripts/init_sheets.py
```

## ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะฑัะทะฐัะตะปัะฝะฐั |
|------------|----------|--------------|
| `KEYCRM_API_TOKEN` | ะขะพะบะตะฝ KeyCRM API | ะะฐ |
| `GSHEETS_ID` | ID Google Sheets ะบะฝะธะณะธ | ะะฐ |
| `GOOGLE_CREDENTIALS_JSON` | Service Account credentials | ะะฐ |
| `TELEGRAM_BOT_TOKEN` | ะขะพะบะตะฝ Telegram ะฑะพัะฐ | ะะฐ |
| `TELEGRAM_ALLOWED_USERS` | ะกะฟะธัะพะบ ัะฐะทัะตัะตะฝะฝัั user_id | ะะฐ |

ะะพะปะฝัะน ัะฟะธัะพะบ ัะผ. ะฒ [.env.example](.env.example)

## ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะผะฐะฝะดั ัะฐะทัะฐะฑะพัะบะธ

```bash
make help              # ะะพะบะฐะทะฐัั ะฒัะต ะบะพะผะฐะฝะดั
make install-dev       # ะฃััะฐะฝะพะฒะธัั dev ะทะฐะฒะธัะธะผะพััะธ  
make test             # ะะฐะฟัััะธัั ัะตััั
make lint             # ะัะพะฒะตัะธัั ะบะพะด
make format           # ะััะพัะผะฐัะธัะพะฒะฐัั ะบะพะด
make typecheck        # ะัะพะฒะตัะธัั ัะธะฟั
```

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
src/
โโโ core/              # ะะฐะทะพะฒัะต ะผะพะดะตะปะธ ะธ ะฒะฐะปะธะดะฐัะธั
โโโ integrations/      # ะะปะธะตะฝัั ะฒะฝะตัะฝะธั API
โโโ services/          # ะะธะทะฝะตั-ัะตัะฒะธัั
โโโ webhook/           # FastAPI endpoint
โโโ bot/              # Telegram ะฑะพั
โโโ scheduler/        # ะะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐั
โโโ utils/            # ะฃัะธะปะธัั

tests/                # ะขะตััั
scripts/              # ะัะฟะพะผะพะณะฐัะตะปัะฝัะต ัะบัะธะฟัั
docs/                 # ะะพะบัะผะตะฝัะฐัะธั
```

### ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# ะัะต ัะตััั
make test

# ะขะตััั ั ะฟะพะบัััะธะตะผ
make test-coverage

# ะะพะฝะบัะตัะฝัะต ัะตััั
pytest tests/test_models.py -v
```

## Production ะดะตะฟะปะพะน

### Docker Compose

```bash
# ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ
make build
make up

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
make status

# ะะพะณะธ
make logs
```

### ะกะตัะฒะธัั

- **Webhook**: `http://localhost:8000` - ะฟัะธะตะผ ะฒะตะฑััะบะพะฒ KeyCRM
- **Health Check**: `http://localhost:8000/health`
- **API Docs**: `http://localhost:8000/docs`

## Google Sheets ััััะบัััะฐ

ะกะธััะตะผะฐ ัะพะทะดะฐะตั ะบะฝะธะณั "Timosh Blanks Planning" ัะพ ัะปะตะดัััะธะผะธ ะปะธััะฐะผะธ:

- **Master_Blanks** - ัะฟัะฐะฒะพัะฝะธะบ ะทะฐะณะพัะพะฒะพะบ (20 SKU)
- **Current_Stock** - ัะตะบััะธะต ะพััะฐัะบะธ
- **Movements** - ะฒัะต ะดะฒะธะถะตะฝะธั ัะพะฒะฐัะฐ  
- **Mapping** - ะฟัะฐะฒะธะปะฐ ะผะฐะฟะฟะธะฝะณะฐ KeyCRM โ ะทะฐะณะพัะพะฒะบะธ
- **Replenishment_Report** - ัะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะทะฐะบัะฟะบะฐะผ
- **Config** - ัะธััะตะผะฝัะต ะฟะฐัะฐะผะตััั

## Telegram ะฑะพั

### ะะพะผะฐะฝะดั

- `/start` - ะณะปะฐะฒะฝะพะต ะผะตะฝั
- `/receipt` - ะดะพะฑะฐะฒะธัั ะฟัะธัะพะด
- `/report` - ะพััะตั ะพััะฐัะบะพะฒ
- `/help` - ัะฟัะฐะฒะบะฐ

### ะัะธัะพะด ัะพะฒะฐัะฐ

```
ะะพะปัะทะพะฒะฐัะตะปั: โ ะัะธัะพะด
ะะพั: ะัะฑะตัะธัะต ัะธะฟ ะทะฐะณะพัะพะฒะบะธ:
     [ะะพััั] [ะัะฑะปะธะบ] [ะััะณะปัะน] [ะคะธะณััะฝัะน]

ะะพะปัะทะพะฒะฐัะตะปั: ะคะธะณััะฝัะน  
ะะพั: ะัะฑะตัะธัะต ัะพัะผั:
     [ะกะตัะดัะต] [ะฆะฒะตัะพะบ] [ะะฑะปะฐะบะพ]

ะะพะปัะทะพะฒะฐัะตะปั: ะกะตัะดัะต
ะะพั: ะัะฑะตัะธัะต ัะฒะตั:
     [๐ก ะะพะปะพัะพ] [โช ะกะตัะตะฑัะพ]

ะะพะปัะทะพะฒะฐัะตะปั: ะะพะปะพัะพ
ะะพั: ะะฒะตะดะธัะต ะบะพะปะธัะตััะฒะพ ะดะปั BLK-HEART-25-GLD:

ะะพะปัะทะพะฒะฐัะตะปั: 250
ะะพั: โ ะะพะฑะฐะฒะปะตะฝ ะฟัะธัะพะด:
     BLK-HEART-25-GLD: +250 ัั
     ะััะฐัะพะบ: 420 ัั
```

## Webhook ะธะฝัะตะณัะฐัะธั KeyCRM

### ะะฐัััะพะนะบะฐ webhook

1. ะ KeyCRM ะฟะตัะตะนัะธ ะฒ ะฝะฐัััะพะนะบะธ webhook
2. URL: `https://your-domain.com/webhook/keycrm`  
3. ะกะพะฑััะธั: `order.change_order_status`
4. ะกะตะบัะตัะฝัะน ะบะปัั: ะทะฝะฐัะตะฝะธะต ะธะท `KEYCRM_WEBHOOK_SECRET`

### ะะฑัะฐะฑะพัะบะฐ ะทะฐะบะฐะทะพะฒ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ:
1. ะะพะปััะฐะตั ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะฟะพะดัะฒะตัะถะดะตะฝะฝะพะผ ะทะฐะบะฐะทะต
2. ะะฐะณััะถะฐะตั ะดะตัะฐะปะธ ะทะฐะบะฐะทะฐ ัะตัะตะท API
3. ะะฐะฟะฟะธั ัะพะฒะฐัั ะฝะฐ ะทะฐะณะพัะพะฒะบะธ
4. ะกะพะทะดะฐะตั ะดะฒะธะถะตะฝะธั ัะฐััะพะดะฐ
5. ะะฑะฝะพะฒะปัะตั ะพััะฐัะบะธ ะฒ Google Sheets

## ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธ

### Health Checks

- `GET /health` - ะฑะฐะทะพะฒะฐั ะฟัะพะฒะตัะบะฐ
- `GET /ready` - ะณะพัะพะฒะฝะพััั ะบ ัะฐะฑะพัะต

### ะะพะณะธ

```bash
# ะะพะณะธ ะฒัะตั ัะตัะฒะธัะพะฒ
make logs

# ะะพะณะธ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
docker-compose logs -f webhook
```

### ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ะปะพะณะธ

ะัะต ะปะพะณะธ ะฒ JSON ัะพัะผะฐัะต ั ะฟะพะปัะผะธ:
- `timestamp`, `level`, `message`
- `service`, `component`, `user_id`
- `correlation_id` ะดะปั ััะฐััะธัะพะฒะบะธ

## ะะตะทะพะฟะฐัะฝะพััั

- โ HMAC ะฟะพะดะฟะธัั ะฒะตะฑััะบะพะฒ
- โ Whitelist Telegram ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ ะะฐะปะธะดะฐัะธั ะฒัะตั ะฒัะพะดะฝัั ะดะฐะฝะฝัั
- โ ะกะตะบัะตัั ะฒ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
- โ ะะตะฟัะธะฒะธะปะตะณะธัะพะฒะฐะฝะฝัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ Docker
- โ Rate limiting ะฝะฐ endpoint

## ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:

1. ะัะพะฒะตัััะต ะปะพะณะธ: `make logs`
2. ะัะพะฒะตัััะต health check: `curl http://localhost:8000/health`
3. ะัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
4. ะกะพะทะดะฐะนัะต issue ะฒ ัะตะฟะพะทะธัะพัะธะธ

## ะะธัะตะฝะทะธั

MIT License - ัะผ. [LICENSE](LICENSE)