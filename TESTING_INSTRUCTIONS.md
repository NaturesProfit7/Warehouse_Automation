# 🧪 Инструкции для ручного тестирования системы мониторинга

## 🚀 Статус системы
✅ Сервер запущен с планировщиком (`main_with_scheduler.py`)  
✅ Все тесты пройдены (54/54)  
✅ Планировщик активен с 4 задачами  

## 📋 План тестирования

### 1. 🏥 Базовый мониторинг системы

**Команда в Telegram**: `/health`

**Ожидаемый результат**:
```
🏥 Состояние системы
✅ Общий статус: Здоров

⏱️ Время работы: 0ч 2м
🚨 Критичные проблемы: 0
⚠️ Предупреждения: 0

📊 Компоненты:
✅ Telegram Bot: Здоров (45мс)
✅ Google Sheets: Здоров (120мс)
✅ Stock Service: Здоров (15мс)
✅ Notification Service: Здоров
✅ Database Sheets: Здоров
⚠️ External Apis: Предупреждение (200мс)

🕒 Проверено: HH:MM:SS

[📈 Тренды] [🔄 Обновить]
[⚙️ Планировщик] [🔔 Уведомления]
```

**Что тестировать**:
- [ ] Команда `/health` отвечает быстро (< 10 сек)
- [ ] Все компоненты показывают статус (✅ или ⚠️)
- [ ] Кнопки интерактивны
- [ ] Время работы увеличивается

### 2. 🔄 Интерактивные кнопки

**Тест кнопки "🔄 Обновить"**:
- [ ] Статус обновляется
- [ ] Время проверки изменяется
- [ ] Появляется сообщение "✅ Информация обновлена"

**Тест кнопки "📈 Тренды"**:
- [ ] Показывается сводная статистика
- [ ] Время работы в часах
- [ ] Количество здоровых компонентов

### 3. ⚙️ Статус планировщика

**Кнопка "⚙️ Планировщик"**:

**Ожидаемый результат**:
```
⚙️ Статус планировщика
🟢 Статус: Работает
🌍 Часовой пояс: Europe/Kyiv
📋 Задач: 4

Активные задачи:
• Проверка критических остатков
  ⏰ Следующий запуск: HH:MM:SS
• Ежедневная сводка
  ⏰ Следующий запуск: 09:00:00
• Обновление статистики использования
  ⏰ Следующий запуск: HH:MM:SS
• Проверка состояния системы
  ⏰ Следующий запуск: HH:MM:SS
```

**Что тестировать**:
- [ ] Статус "Работает"
- [ ] 4 активные задачи
- [ ] Время следующего запуска указано
- [ ] Часовой пояс Europe/Kyiv

### 4. 🔔 Служба уведомлений

**Кнопка "🔔 Уведомления"**:

**Ожидаемый результат**:
```
🔔 Служба уведомлений

⚙️ Конфигурация:
• Критичные: каждые 1ч
• Важные: каждые 8ч
• Дневная сводка: включена
• Час сводки: 9:00
• Минимум критичных для уведомления: 1
• Максимум позиций в сообщении: 10

📨 Последние уведомления:
• Пока нет отправленных уведомлений

[🧪 Тест критичных] [📊 Сводка сейчас]
[🔙 Назад]
```

**Что тестировать**:
- [ ] Конфигурация показывается корректно
- [ ] Кнопки тестирования доступны

### 5. 🧪 Тестирование уведомлений

**Кнопка "🧪 Тест критичных"**:
- [ ] Появляется сообщение "🔍 Проверяю критичные остатки..."
- [ ] Через несколько секунд - результат:
  - "✅ Тест выполнен. Уведомление отправлено." (если есть критичные)
  - "ℹ️ Критичных остатков не обнаружено." (если все ОК)

**Кнопка "📊 Сводка сейчас"**:
- [ ] Появляется сообщение "📊 Генерирую ежедневную сводку..."
- [ ] Отправляется ежедневная сводка с данными:

```
📊 Ежедневная сводка склада
📅 27.08.2025

📦 Общая статистика:
• Всего SKU: 123
• Общий остаток: 45678 шт
• Позиций с остатком <50: 12

⚠️ Требуют внимания:
• Критичные: 3 позиций
• Важные: 8 позиций
• Всего к заказу: 15 позиций

🚨 Критичные остатки:
• BLK-BONE-30-GLD: 5 шт
• BLK-RING-25-SIL: 12 шт
...

💡 Используйте /analytics для детального анализа
```

### 6. 📊 Интеграция с существующими командами

**Проверить что работают старые команды**:
- [ ] `/start` - показывает главное меню
- [ ] `/report` - генерирует отчеты
- [ ] `/receipt` - добавление прихода
- [ ] `/analytics` - показывает аналитику

### 7. 🔁 Автоматические задачи (наблюдение)

**Следить за логами** (~10-15 минут):
- [ ] Каждые 15 минут: "System health check completed"
- [ ] Каждые 30 минут: "Running critical stock check job"
- [ ] В 9:00 (если время подходящее): "Running daily summary job"

## 🚨 Критические проблемы для проверки

### Конфигурация
- [ ] `ADMIN_USER_IDS` настроены в .env
- [ ] `TELEGRAM_BOT_TOKEN` работает
- [ ] Google Sheets доступны

### Ошибки в логах
Следите за ошибками типа:
- `Failed to check critical stock`
- `Failed to send telegram alert`
- `Failed to generate daily summary`
- `Health check failed`

## 📝 Отчет о тестировании

**Заполните по результатам**:

### ✅ Успешно протестировано:
- [ ] Команда `/health` работает
- [ ] Интерактивные кнопки отвечают
- [ ] Планировщик показывает 4 задачи
- [ ] Тестирование уведомлений работает
- [ ] Принудительная сводка генерируется
- [ ] Старые команды не сломались

### ❌ Обнаруженные проблемы:
- [ ] Команды не отвечают
- [ ] Ошибки в статусе компонентов
- [ ] Планировщик не работает
- [ ] Уведомления не отправляются
- [ ] Проблемы с Google Sheets
- [ ] Конфликты с существующим ботом

### 🔧 Необходимые исправления:
- [ ] Нет критичных проблем
- [ ] Требует настройки конфигурации
- [ ] Нужны исправления кода
- [ ] Требует дополнительного тестирования

## 📊 Мониторинг логов

Я буду отслеживать логи в реальном времени. Сообщайте о любых проблемах!

**Ключевые события в логах**:
- `✅ All services started successfully!`
- `📱 Bot polling started` 
- `System health check completed`
- `Critical stock alert generated`
- `Daily summary generated`

---
**Время начала тестирования**: ${new Date().toLocaleString('ru')}  
**Версия**: v2.0 с мониторингом и планировщиком